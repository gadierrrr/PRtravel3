<section class="hero" role="banner">
  <h1>Discover Puerto Rico Deals</h1>
  <p>Curated getaways, surf spots & cultural escapes.</p>
  <a class="btn" href="/signup">Get Early Access</a>
</section>
<section class="grid" aria-label="Deals list">
  <% if (deals && deals.length) { %>
    <% deals.forEach(d => { %>
      <a class="card" href="/deal/<%= encodeURIComponent(d.slug) %>">
        <img src="<%= d.image_url %>" alt="<%= d.title %>" />
        <% if (d.badge_text) { %><span class="badge"><%= d.badge_text %></span><% } %>
        <h3><%= d.title %></h3>
        <% if (d.merchant_name) { %><p class="merchant"><%= d.merchant_name %></p><% } %>
        <% if (d.from_price_cents != null) { %>
          <p class="price">
            From $<%= (d.from_price_cents/100).toFixed(2) %>
            <% if (d.discount_percent) { %><span class="discount">-<%= d.discount_percent %>%</span><% } %>
          </p>
        <% } %>
        <% if (d.rating_avg) { %><p class="rating">‚≠ê <%= d.rating_avg.toFixed(1) %><span class="rcount">(<%= d.rating_count || 0 %>)</span></p><% } %>
        <p class="teaser"><%= d.teaser || '' %></p>
        <% if (d.ends_at) { %>
          <p class="time-left" data-ends="<%= d.ends_at %>"></p>
        <% } %>
      </a>
    <% }) %>
  <% } else { %>
    <p>No deals yet.</p>
  <% } %>
</section>
<script>
  document.querySelectorAll('.time-left[data-ends]').forEach(el=>{
    const ends = new Date(el.getAttribute('data-ends')).getTime();
    const diffMs = ends - Date.now();
    if (diffMs>0){
      const days = Math.ceil(diffMs/86400000);
      el.textContent = days + ' day' + (days!==1?'s':'') + ' left';
    } else {
      el.textContent = 'Ends soon';
    }
  });
</script>
